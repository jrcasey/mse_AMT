<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of addRxns</title>
  <meta name="keywords" content="addRxns">
  <meta name="description" content="addRxns">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">core</a> &gt; addRxns.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for core&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>addRxns
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>addRxns</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> addRxns
   Adds reactions to a model

   model            a model structure
   rxnsToAdd        the reaction structure can have the following fields:
            rxns               cell array with unique strings that
                               identifies each reaction
            equations          cell array with equation strings. Decimal
                               coefficients are expressed as &quot;1.2&quot;.
                               Reversibility is indicated by &quot;&lt;=&gt;&quot; or &quot;=&gt;&quot;
            rxnNames           cell array with the names of each reaction
                               (opt, default '')
            lb                 vector with the lower bounds (opt, default
                               -inf for reversible reactions and 0 for
                               irreversible)
            ub                 vector with the upper bounds (opt, default
                               inf)
            c                  vector with the objective function
                               coefficients (opt, default 0)
            eccodes            cell array with the EC-numbers for each
                               reactions. Delimit several EC-numbers with
                               &quot;;&quot; (opt, default '')
            subSystems         cell array with the subsystems for each
                               reaction (opt, default '')
            grRules            cell array with the gene-reaction
                               relationship for each reaction. For example
                               &quot;(A and B) or (C)&quot; means that the reaction
                               could be catalyzed by a complex between
                               A &amp; B or by C on its own. All the genes
                               have to be present in model.genes. Add
                               genes with addGenes before calling this
                               function if needed (opt, default '')
            rxnMiriams         cell array with Miriam structures (opt,
                               default [])
            rxnComps           cell array with compartments (as in
                               model.comps) (opt, default {})
            rxnNotes           cell array with reaction notes (opt,
                               default '')
            rxnReferences      cell array with reaction references (opt,
                               default '')
            confidenceScores   cell array with reaction confidence scores
                               (opt, default '')
   eqnType          double describing how the equation string should be
                    interpreted
                    1 - The metabolites are matched to model.mets. New
                        metabolites (if allowed) are added to
                        &quot;compartment&quot;
                    2 - The metabolites are matched to model.metNames and
                        all metabolites are assigned to &quot;compartment&quot;. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are
                        already used in the model then the numbering will
                        start from the highest used integer+1
                    3 - The metabolites are written as
                        &quot;metNames[comps]&quot;. Only compartments in
                        model.comps are allowed. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are
                        already used in the model then the numbering will
                        start from the highest used integer+1
   compartment      a string with the compartment the metabolites should
                    be placed in when using eqnType=2. Must match
                    model.comps (opt when eqnType=1 or eqnType=3)
   allowNewMets     true if the function is allowed to add new
                    metabolites. It is highly recommended to first add
                    any new metabolites with addMets rather than
                    automatically through this function. addMets supports
                    more annotation of metabolites, allows for the use of
                    exchange metabolites, and using it reduces the risk
                    of parsing errors (opt, default false)

   newModel         an updated model structure

   NOTE: This function does not make extensive checks about formatting of
   gene-reaction rules.

   NOTE: When adding metabolites to a compartment where it previously
   doesn't exist, the function will copy any available information from
   the metabolite in another compartment.

   Usage: newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)

   Simonas Marcisauskas, 2016-11-01 - added support for rxnNotes,
   rxnReferences and confidenceScores</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>	addMets</li><li><a href="constructS.html" class="code" title="function [S, mets, badRxns, reversible]=constructS(equations,mets,rxns)">constructS</a>	constructS</li><li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>	changeRxns</li><li><a href="checkTasks.html" class="code" title="function [taskReport, essentialRxns, taskStructure]=checkTasks(model,inputFile,printOutput,printOnlyFailed,getEssential,taskStructure)">checkTasks</a>	checkTasks</li><li><a href="fitTasks.html" class="code" title="function [outModel, addedRxns]=fitTasks(model,refModel,inputFile,printOutput,rxnScores,taskStructure,params)">fitTasks</a>	fitTasks</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)</a>
0002 <span class="comment">% addRxns</span>
0003 <span class="comment">%   Adds reactions to a model</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   model            a model structure</span>
0006 <span class="comment">%   rxnsToAdd        the reaction structure can have the following fields:</span>
0007 <span class="comment">%            rxns               cell array with unique strings that</span>
0008 <span class="comment">%                               identifies each reaction</span>
0009 <span class="comment">%            equations          cell array with equation strings. Decimal</span>
0010 <span class="comment">%                               coefficients are expressed as &quot;1.2&quot;.</span>
0011 <span class="comment">%                               Reversibility is indicated by &quot;&lt;=&gt;&quot; or &quot;=&gt;&quot;</span>
0012 <span class="comment">%            rxnNames           cell array with the names of each reaction</span>
0013 <span class="comment">%                               (opt, default '')</span>
0014 <span class="comment">%            lb                 vector with the lower bounds (opt, default</span>
0015 <span class="comment">%                               -inf for reversible reactions and 0 for</span>
0016 <span class="comment">%                               irreversible)</span>
0017 <span class="comment">%            ub                 vector with the upper bounds (opt, default</span>
0018 <span class="comment">%                               inf)</span>
0019 <span class="comment">%            c                  vector with the objective function</span>
0020 <span class="comment">%                               coefficients (opt, default 0)</span>
0021 <span class="comment">%            eccodes            cell array with the EC-numbers for each</span>
0022 <span class="comment">%                               reactions. Delimit several EC-numbers with</span>
0023 <span class="comment">%                               &quot;;&quot; (opt, default '')</span>
0024 <span class="comment">%            subSystems         cell array with the subsystems for each</span>
0025 <span class="comment">%                               reaction (opt, default '')</span>
0026 <span class="comment">%            grRules            cell array with the gene-reaction</span>
0027 <span class="comment">%                               relationship for each reaction. For example</span>
0028 <span class="comment">%                               &quot;(A and B) or (C)&quot; means that the reaction</span>
0029 <span class="comment">%                               could be catalyzed by a complex between</span>
0030 <span class="comment">%                               A &amp; B or by C on its own. All the genes</span>
0031 <span class="comment">%                               have to be present in model.genes. Add</span>
0032 <span class="comment">%                               genes with addGenes before calling this</span>
0033 <span class="comment">%                               function if needed (opt, default '')</span>
0034 <span class="comment">%            rxnMiriams         cell array with Miriam structures (opt,</span>
0035 <span class="comment">%                               default [])</span>
0036 <span class="comment">%            rxnComps           cell array with compartments (as in</span>
0037 <span class="comment">%                               model.comps) (opt, default {})</span>
0038 <span class="comment">%            rxnNotes           cell array with reaction notes (opt,</span>
0039 <span class="comment">%                               default '')</span>
0040 <span class="comment">%            rxnReferences      cell array with reaction references (opt,</span>
0041 <span class="comment">%                               default '')</span>
0042 <span class="comment">%            confidenceScores   cell array with reaction confidence scores</span>
0043 <span class="comment">%                               (opt, default '')</span>
0044 <span class="comment">%   eqnType          double describing how the equation string should be</span>
0045 <span class="comment">%                    interpreted</span>
0046 <span class="comment">%                    1 - The metabolites are matched to model.mets. New</span>
0047 <span class="comment">%                        metabolites (if allowed) are added to</span>
0048 <span class="comment">%                        &quot;compartment&quot;</span>
0049 <span class="comment">%                    2 - The metabolites are matched to model.metNames and</span>
0050 <span class="comment">%                        all metabolites are assigned to &quot;compartment&quot;. Any</span>
0051 <span class="comment">%                        new metabolites that are added will be assigned</span>
0052 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0053 <span class="comment">%                        already used in the model then the numbering will</span>
0054 <span class="comment">%                        start from the highest used integer+1</span>
0055 <span class="comment">%                    3 - The metabolites are written as</span>
0056 <span class="comment">%                        &quot;metNames[comps]&quot;. Only compartments in</span>
0057 <span class="comment">%                        model.comps are allowed. Any</span>
0058 <span class="comment">%                        new metabolites that are added will be assigned</span>
0059 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0060 <span class="comment">%                        already used in the model then the numbering will</span>
0061 <span class="comment">%                        start from the highest used integer+1</span>
0062 <span class="comment">%   compartment      a string with the compartment the metabolites should</span>
0063 <span class="comment">%                    be placed in when using eqnType=2. Must match</span>
0064 <span class="comment">%                    model.comps (opt when eqnType=1 or eqnType=3)</span>
0065 <span class="comment">%   allowNewMets     true if the function is allowed to add new</span>
0066 <span class="comment">%                    metabolites. It is highly recommended to first add</span>
0067 <span class="comment">%                    any new metabolites with addMets rather than</span>
0068 <span class="comment">%                    automatically through this function. addMets supports</span>
0069 <span class="comment">%                    more annotation of metabolites, allows for the use of</span>
0070 <span class="comment">%                    exchange metabolites, and using it reduces the risk</span>
0071 <span class="comment">%                    of parsing errors (opt, default false)</span>
0072 <span class="comment">%</span>
0073 <span class="comment">%   newModel         an updated model structure</span>
0074 <span class="comment">%</span>
0075 <span class="comment">%   NOTE: This function does not make extensive checks about formatting of</span>
0076 <span class="comment">%   gene-reaction rules.</span>
0077 <span class="comment">%</span>
0078 <span class="comment">%   NOTE: When adding metabolites to a compartment where it previously</span>
0079 <span class="comment">%   doesn't exist, the function will copy any available information from</span>
0080 <span class="comment">%   the metabolite in another compartment.</span>
0081 <span class="comment">%</span>
0082 <span class="comment">%   Usage: newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets)</span>
0083 <span class="comment">%</span>
0084 <span class="comment">%   Simonas Marcisauskas, 2016-11-01 - added support for rxnNotes,</span>
0085 <span class="comment">%   rxnReferences and confidenceScores</span>
0086 <span class="comment">%</span>
0087 
0088 <span class="keyword">if</span> nargin&lt;4
0089     compartment=[];
0090 <span class="keyword">end</span>
0091 <span class="keyword">if</span> nargin&lt;5
0092     allowNewMets=false;
0093 <span class="keyword">end</span>
0094 
0095 newModel=model;
0096 
0097 <span class="comment">%If no reactions should be added</span>
0098 <span class="keyword">if</span> isempty(rxnsToAdd)
0099     <span class="keyword">return</span>;
0100 <span class="keyword">end</span>
0101 
0102 <span class="comment">%Check the input</span>
0103 <span class="keyword">if</span> ~isnumeric(eqnType)
0104     EM=<span class="string">'eqnType must be numeric'</span>;
0105     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0106 <span class="keyword">else</span>
0107     <span class="keyword">if</span> ~ismember(eqnType,[1 2 3])
0108         EM=<span class="string">'eqnType must be 1, 2, or 3'</span>;
0109         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0110     <span class="keyword">end</span>
0111 <span class="keyword">end</span>
0112 
0113 <span class="keyword">if</span> eqnType==2 || (eqnType==1 &amp;&amp; allowNewMets==true)
0114     <span class="keyword">if</span> ~ischar(compartment)
0115         EM=<span class="string">'compartment must be a string'</span>;
0116         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0117     <span class="keyword">end</span>
0118     <span class="keyword">if</span> ~ismember(compartment,model.comps)
0119         EM=<span class="string">'compartment must match one of the compartments in model.comps'</span>;
0120         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0121     <span class="keyword">end</span>
0122 <span class="keyword">end</span>
0123 
0124 <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'rxns'</span>)
0125     EM=<span class="string">'rxns is a required field in rxnsToAdd'</span>;
0126     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0127 <span class="keyword">else</span>
0128     <span class="comment">%To fit with some later printing</span>
0129     rxnsToAdd.rxns=rxnsToAdd.rxns(:);
0130 <span class="keyword">end</span>
0131 <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'equations'</span>)
0132     EM=<span class="string">'equations is a required field in rxnsToAdd'</span>;
0133     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0134 <span class="keyword">end</span>
0135 
0136 <span class="keyword">if</span> any(ismember(rxnsToAdd.rxns,model.rxns))
0137     EM=<span class="string">'One or more reaction id was already present in the model. Use changeRxns or remove the existing reactions before adding new ones'</span>;
0138     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0139 <span class="keyword">end</span>
0140 
0141 <span class="keyword">if</span> ~iscellstr(rxnsToAdd.rxns) &amp;&amp; ~ischar(rxnsToAdd.rxns)
0142     <span class="comment">%It could also be a string, but it's not encouraged</span>
0143     EM=<span class="string">'rxnsToAdd.rxns must be a cell array of strings'</span>;
0144     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0145 <span class="keyword">else</span>
0146     rxnsToAdd.rxns=cellstr(rxnsToAdd.rxns);
0147 <span class="keyword">end</span>
0148 <span class="keyword">if</span> ~iscellstr(rxnsToAdd.equations) &amp;&amp; ~ischar(rxnsToAdd.equations)
0149     <span class="comment">%It could also be a string, but it's not encouraged</span>
0150     EM=<span class="string">'rxnsToAdd.equations must be a cell array of strings'</span>;
0151     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0152 <span class="keyword">else</span>
0153     rxnsToAdd.equations=cellstr(rxnsToAdd.equations);
0154 <span class="keyword">end</span>
0155 
0156 <span class="comment">%Check some formatting</span>
0157 illegalCells=regexp(rxnsToAdd.rxns,<span class="string">'[^a-z_A-Z0-9]'</span>, <span class="string">'once'</span>);
0158 EM=<span class="string">'Illegal character(s) in reaction IDs:'</span>;
0159 <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,true,rxnsToAdd.rxns(~cellfun(@isempty,illegalCells)));
0160 
0161 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNames'</span>)
0162     illegalCells=regexp(rxnsToAdd.rxnNames,<span class="string">'[&quot;%&lt;&gt;\\]'</span>, <span class="string">'once'</span>);
0163     EM=<span class="string">'Illegal character(s) in reaction names:'</span>;
0164     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,true,rxnsToAdd.rxnNames(~cellfun(@isempty,illegalCells)));
0165 <span class="keyword">end</span>
0166 
0167 nRxns=numel(rxnsToAdd.rxns);
0168 nOldRxns=numel(model.rxns);
0169 filler=cell(nRxns,1);
0170 filler(:)={<span class="string">''</span>};
0171 largeFiller=cell(nOldRxns,1);
0172 largeFiller(:)={<span class="string">''</span>};
0173 
0174 <span class="comment">%***Add everything to the model except for the equations.</span>
0175 <span class="keyword">if</span> numel(rxnsToAdd.equations)~=nRxns
0176    EM=<span class="string">'rxnsToAdd.equations must have the same number of elements as rxnsToAdd.rxns'</span>;
0177    <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0178 <span class="keyword">end</span>
0179 
0180 <span class="comment">%Parse the equations. This is done at this early stage since I need the</span>
0181 <span class="comment">%reversibility info</span>
0182 [S mets badRxns reversible]=<a href="constructS.html" class="code" title="function [S, mets, badRxns, reversible]=constructS(equations,mets,rxns)">constructS</a>(rxnsToAdd.equations);
0183 EM=<span class="string">'The following equations have one or more metabolites both as substrate and product. Only the net equations will be added:'</span>;
0184 <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false,rxnsToAdd.rxns(badRxns));
0185 
0186 newModel.rev=[newModel.rev;reversible];
0187 newModel.rxns=[newModel.rxns;rxnsToAdd.rxns(:)];
0188 
0189 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNames'</span>)
0190    <span class="keyword">if</span> numel(rxnsToAdd.rxnNames)~=nRxns
0191        EM=<span class="string">'rxnsToAdd.rxnNames must have the same number of elements as rxnsToAdd.rxns'</span>;
0192        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0193    <span class="keyword">end</span>
0194    <span class="comment">%Fill with standard if it doesn't exist</span>
0195    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNames'</span>)
0196        newModel.rxnNames=largeFiller;
0197    <span class="keyword">end</span>
0198    newModel.rxnNames=[newModel.rxnNames;rxnsToAdd.rxnNames(:)];
0199 <span class="keyword">else</span>
0200     <span class="comment">%Fill with standard if it doesn't exist</span>
0201    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNames'</span>)
0202        newModel.rxnNames=[newModel.rxnNames;filler];
0203    <span class="keyword">end</span>
0204 <span class="keyword">end</span>
0205 
0206 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'lb'</span>)
0207    <span class="keyword">if</span> numel(rxnsToAdd.lb)~=nRxns
0208        EM=<span class="string">'rxnsToAdd.lb must have the same number of elements as rxnsToAdd.rxns'</span>;
0209        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0210    <span class="keyword">end</span>
0211    <span class="comment">%Fill with standard if it doesn't exist</span>
0212    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'lb'</span>)
0213        newModel.lb=zeros(nOldRxns,1);
0214        newModel.lb(newModel.rev~=0)=-inf;
0215    <span class="keyword">end</span>
0216    newModel.lb=[newModel.lb;rxnsToAdd.lb(:)];
0217 <span class="keyword">else</span>
0218     <span class="comment">%Fill with standard if it doesn't exist</span>
0219    <span class="keyword">if</span> isfield(newModel,<span class="string">'lb'</span>)
0220        I=zeros(nRxns,1);
0221        I(reversible~=0)=-inf;
0222        newModel.lb=[newModel.lb;I];
0223    <span class="keyword">end</span>
0224 <span class="keyword">end</span>
0225 
0226 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'ub'</span>)
0227    <span class="keyword">if</span> numel(rxnsToAdd.ub)~=nRxns
0228        EM=<span class="string">'rxnsToAdd.ub must have the same number of elements as rxnsToAdd.rxns'</span>;
0229        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0230    <span class="keyword">end</span>
0231    <span class="comment">%Fill with standard if it doesn't exist</span>
0232    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'ub'</span>)
0233        newModel.ub=inf(nOldRxns,1);
0234    <span class="keyword">end</span>
0235    newModel.ub=[newModel.ub;rxnsToAdd.ub(:)];
0236 <span class="keyword">else</span>
0237     <span class="comment">%Fill with standard if it doesn't exist</span>
0238    <span class="keyword">if</span> isfield(newModel,<span class="string">'ub'</span>)
0239        newModel.ub=[newModel.ub;inf(nRxns,1)];
0240    <span class="keyword">end</span>
0241 <span class="keyword">end</span>
0242 
0243 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'c'</span>)
0244    <span class="keyword">if</span> numel(rxnsToAdd.c)~=nRxns
0245        EM=<span class="string">'rxnsToAdd.c must have the same number of elements as rxnsToAdd.rxns'</span>;
0246        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0247    <span class="keyword">end</span>
0248    <span class="comment">%Fill with standard if it doesn't exist</span>
0249    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'c'</span>)
0250        newModel.c=zeros(nOldRxns,1);
0251    <span class="keyword">end</span>
0252    newModel.c=[newModel.c;rxnsToAdd.c(:)];
0253 <span class="keyword">else</span>
0254     <span class="comment">%Fill with standard if it doesn't exist</span>
0255    <span class="keyword">if</span> isfield(newModel,<span class="string">'c'</span>)
0256        newModel.c=[newModel.c;zeros(nRxns,1)];
0257    <span class="keyword">end</span>
0258 <span class="keyword">end</span>
0259 
0260 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'eccodes'</span>)
0261    <span class="keyword">if</span> numel(rxnsToAdd.eccodes)~=nRxns
0262        EM=<span class="string">'rxnsToAdd.eccodes must have the same number of elements as rxnsToAdd.rxns'</span>;
0263        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0264    <span class="keyword">end</span>
0265    <span class="comment">%Fill with standard if it doesn't exist</span>
0266    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'eccodes'</span>)
0267        newModel.eccodes=largeFiller;
0268    <span class="keyword">end</span>
0269    newModel.eccodes=[newModel.eccodes;rxnsToAdd.eccodes(:)];
0270 <span class="keyword">else</span>
0271     <span class="comment">%Fill with standard if it doesn't exist</span>
0272    <span class="keyword">if</span> isfield(newModel,<span class="string">'eccodes'</span>)
0273        newModel.eccodes=[newModel.eccodes;filler];
0274    <span class="keyword">end</span>
0275 <span class="keyword">end</span>
0276 
0277 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'subSystems'</span>)
0278    <span class="keyword">if</span> numel(rxnsToAdd.subSystems)~=nRxns
0279        EM=<span class="string">'rxnsToAdd.subSystems must have the same number of elements as rxnsToAdd.rxns'</span>;
0280        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0281    <span class="keyword">end</span>
0282    <span class="comment">%Fill with standard if it doesn't exist</span>
0283    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'subSystems'</span>)
0284        newModel.subSystems=largeFiller;
0285    <span class="keyword">end</span>
0286    newModel.subSystems=[newModel.subSystems;rxnsToAdd.subSystems(:)];
0287 <span class="keyword">else</span>
0288     <span class="comment">%Fill with standard if it doesn't exist</span>
0289    <span class="keyword">if</span> isfield(newModel,<span class="string">'subSystems'</span>)
0290        newModel.subSystems=[newModel.subSystems;filler];
0291    <span class="keyword">end</span>
0292 <span class="keyword">end</span>
0293 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnMiriams'</span>)
0294    <span class="keyword">if</span> numel(rxnsToAdd.rxnMiriams)~=nRxns
0295        EM=<span class="string">'rxnsToAdd.rxnMiriams must have the same number of elements as rxnsToAdd.rxns'</span>;
0296        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0297    <span class="keyword">end</span>
0298    <span class="comment">%Fill with standard if it doesn't exist</span>
0299    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnMiriams'</span>)
0300        newModel.rxnMiriams=cell(nOldRxns,1);
0301    <span class="keyword">end</span>
0302    newModel.rxnMiriams=[newModel.rxnMiriams;rxnsToAdd.rxnMiriams(:)];
0303 <span class="keyword">else</span>
0304     <span class="comment">%Fill with standard if it doesn't exist</span>
0305    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnMiriams'</span>)
0306        newModel.rxnMiriams=[newModel.rxnMiriams;cell(nRxns,1)];
0307    <span class="keyword">end</span>
0308 <span class="keyword">end</span>
0309 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnComps'</span>)
0310    <span class="keyword">if</span> numel(rxnsToAdd.rxnComps)~=nRxns
0311        EM=<span class="string">'rxnsToAdd.rxnComps must have the same number of elements as rxnsToAdd.rxns'</span>;
0312        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0313    <span class="keyword">end</span>
0314    <span class="comment">%Fill with standard if it doesn't exist</span>
0315    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnComps'</span>)
0316        newModel.rxnComps=ones(nOldRxns,1);
0317        EM=<span class="string">'Adding reactions with compartment information to a model without such information. All existing reactions will be assigned to the first compartment'</span>;
0318        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false);
0319    <span class="keyword">end</span>
0320    newModel.rxnComps=[newModel.rxnComps;rxnsToAdd.rxnComps(:)];
0321 <span class="keyword">else</span>
0322     <span class="comment">%Fill with standard if it doesn't exist</span>
0323    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnComps'</span>)
0324        newModel.rxnComps=[newModel.rxnComps;ones(nRxns,1)];
0325        <span class="comment">%fprintf('NOTE: The added reactions will be assigned to the first compartment\n');</span>
0326    <span class="keyword">end</span>
0327 <span class="keyword">end</span>
0328 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'grRules'</span>)
0329    <span class="keyword">if</span> numel(rxnsToAdd.grRules)~=nRxns
0330        EM=<span class="string">'rxnsToAdd.grRules must have the same number of elements as rxnsToAdd.rxns'</span>;
0331        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0332    <span class="keyword">end</span>
0333    <span class="comment">%Fill with standard if it doesn't exist</span>
0334    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'grRules'</span>)
0335        newModel.grRules=largeFiller;
0336    <span class="keyword">end</span>
0337    newModel.grRules=[newModel.grRules;rxnsToAdd.grRules(:)];
0338 <span class="keyword">else</span>
0339     <span class="comment">%Fill with standard if it doesn't exist</span>
0340    <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0341        newModel.grRules=[newModel.grRules;filler];
0342    <span class="keyword">end</span>
0343 <span class="keyword">end</span>
0344 
0345 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnFrom'</span>)
0346    <span class="keyword">if</span> numel(rxnsToAdd.rxnFrom)~=nRxns
0347        EM=<span class="string">'rxnsToAdd.rxnFrom must have the same number of elements as rxnsToAdd.rxns'</span>;
0348        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0349    <span class="keyword">end</span>
0350    <span class="comment">%Fill with standard if it doesn't exist</span>
0351    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnFrom'</span>)
0352        newModel.rxnFrom=largeFiller;
0353    <span class="keyword">end</span>
0354    newModel.rxnFrom=[newModel.rxnFrom;rxnsToAdd.rxnFrom(:)];
0355 <span class="keyword">else</span>
0356     <span class="comment">%Fill with standard if it doesn't exist</span>
0357    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnFrom'</span>)
0358        newModel.rxnFrom=[newModel.rxnFrom;filler];
0359    <span class="keyword">end</span>
0360 <span class="keyword">end</span>
0361 
0362 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNotes'</span>)
0363    <span class="keyword">if</span> numel(rxnsToAdd.rxnNotes)~=nRxns
0364        EM=<span class="string">'rxnsToAdd.rxnNotes must have the same number of elements as rxnsToAdd.rxns'</span>;
0365        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0366    <span class="keyword">end</span>
0367    <span class="comment">%Fill with standard if it doesn't exist</span>
0368    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNotes'</span>)
0369        newModel.rxnNotes=largeFiller;
0370    <span class="keyword">end</span>
0371    newModel.rxnNotes=[newModel.rxnNotes;rxnsToAdd.rxnNotes(:)];
0372 <span class="keyword">else</span>
0373     <span class="comment">%Fill with standard if it doesn't exist</span>
0374    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNotes'</span>)
0375        newModel.rxnNotes=[newModel.rxnNotes;filler];
0376    <span class="keyword">end</span>
0377 <span class="keyword">end</span>
0378 
0379 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnReferences'</span>)
0380    <span class="keyword">if</span> numel(rxnsToAdd.rxnReferences)~=nRxns
0381        EM=<span class="string">'rxnsToAdd.rxnReferences must have the same number of elements as rxnsToAdd.rxns'</span>;
0382        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0383    <span class="keyword">end</span>
0384    <span class="comment">%Fill with standard if it doesn't exist</span>
0385    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnReferences'</span>)
0386        newModel.rxnReferences=largeFiller;
0387    <span class="keyword">end</span>
0388    newModel.rxnReferences=[newModel.rxnReferences;rxnsToAdd.rxnReferences(:)];
0389 <span class="keyword">else</span>
0390     <span class="comment">%Fill with standard if it doesn't exist</span>
0391    <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnReferences'</span>)
0392        newModel.rxnReferences=[newModel.rxnReferences;filler];
0393    <span class="keyword">end</span>
0394 <span class="keyword">end</span>
0395 
0396 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'confidenceScores'</span>)
0397    <span class="keyword">if</span> numel(rxnsToAdd.confidenceScores)~=nRxns
0398        EM=<span class="string">'rxnsToAdd.confidenceScores must have the same number of elements as rxnsToAdd.rxns'</span>;
0399        <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0400    <span class="keyword">end</span>
0401    <span class="comment">%Fill with standard if it doesn't exist</span>
0402    <span class="keyword">if</span> ~isfield(newModel,<span class="string">'confidenceScores'</span>)
0403        newModel.confidenceScores=largeFiller;
0404    <span class="keyword">end</span>
0405    newModel.confidenceScores=[newModel.confidenceScores;rxnsToAdd.confidenceScores(:)];
0406 <span class="keyword">else</span>
0407     <span class="comment">%Fill with standard if it doesn't exist</span>
0408    <span class="keyword">if</span> isfield(newModel,<span class="string">'confidenceScores'</span>)
0409        newModel.confidenceScores=[newModel.confidenceScores;filler];
0410    <span class="keyword">end</span>
0411 <span class="keyword">end</span>
0412 
0413 <span class="comment">%Check that ids contain no weird characters. This is only done if the</span>
0414 <span class="comment">%equations are with metabolite ids</span>
0415 <span class="keyword">if</span> eqnType==1
0416     illegalCells=regexp(mets,<span class="string">'[^a-z_A-Z0-9]'</span>, <span class="string">'once'</span>);
0417     EM=<span class="string">'Illegal character(s) in metabolite IDs:'</span>;
0418     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,true,mets(~cellfun(@isempty,illegalCells)));
0419 <span class="keyword">else</span>
0420     <span class="comment">%If the mets are metNames</span>
0421     illegalCells=regexp(mets,<span class="string">'[&quot;%&lt;&gt;\\]'</span>, <span class="string">'once'</span>);
0422     EM=<span class="string">'Illegal character(s) in metabolite names:'</span>;
0423     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,true,mets(~cellfun(@isempty,illegalCells)));
0424 <span class="keyword">end</span>
0425 
0426 <span class="comment">%***Start parsing the equations and adding the info to the S matrix</span>
0427 <span class="comment">%The mets are matched to model.mets</span>
0428 <span class="keyword">if</span> eqnType==1
0429     [I J]=ismember(mets,model.mets);
0430     <span class="keyword">if</span> ~all(I)
0431         <span class="keyword">if</span> allowNewMets==true
0432             <span class="comment">%Add the new mets</span>
0433             metsToAdd.mets=mets(~I);
0434             metsToAdd.metNames=metsToAdd.mets;
0435             metsToAdd.compartments=compartment;
0436             newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>(newModel,metsToAdd);
0437         <span class="keyword">else</span>
0438             EM=<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0439             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0440         <span class="keyword">end</span>
0441     <span class="keyword">end</span>
0442     <span class="comment">%Calculate the indexes of the metabolites and add the info</span>
0443     metIndexes=J;
0444     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0445 <span class="keyword">end</span>
0446 
0447 <span class="comment">%Do some stuff that is the same for eqnType=2 and eqnType=3</span>
0448 <span class="keyword">if</span> eqnType==2 || eqnType==3
0449     <span class="comment">%For later..</span>
0450     t2=strcat(model.metNames,<span class="string">'***'</span>,model.comps(model.metComps));
0451 <span class="keyword">end</span>
0452 
0453 <span class="comment">%The mets are matched to model.metNames and assigned to &quot;compartment&quot;</span>
0454 <span class="keyword">if</span> eqnType==2
0455     <span class="comment">%%Check that the metabolite names aren't present in the same compartment.</span>
0456     <span class="comment">%Not the neatest way maybe..</span>
0457     t1=strcat(mets,<span class="string">'***'</span>,compartment);
0458     [I J]=ismember(t1,t2);
0459 
0460     <span class="keyword">if</span> ~all(I)
0461         <span class="keyword">if</span> allowNewMets==true
0462             <span class="comment">%Add the new mets</span>
0463             metsToAdd.metNames=mets(~I);
0464             metsToAdd.compartments=compartment;
0465             newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>(newModel,metsToAdd);
0466         <span class="keyword">else</span>
0467             EM=<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0468             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0469         <span class="keyword">end</span>
0470     <span class="keyword">end</span>
0471 
0472     <span class="comment">%Calculate the indexes of the metabolites</span>
0473     metIndexes=J;
0474     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0475 <span class="keyword">end</span>
0476 
0477 <span class="comment">%The equations are on the form metNames[compName]</span>
0478 <span class="keyword">if</span> eqnType==3
0479     <span class="comment">%Parse the metabolite names</span>
0480     metNames=cell(numel(mets),1);
0481     compartments=metNames;
0482     <span class="keyword">for</span> i=1:numel(mets)
0483         starts=max(strfind(mets{i},<span class="string">'['</span>));
0484         ends=max(strfind(mets{i},<span class="string">']'</span>));
0485 
0486         <span class="comment">%Check that the formatting is correct</span>
0487         <span class="keyword">if</span> isempty(starts) || isempty(ends) || ends&lt;numel(mets{i})
0488           EM=[<span class="string">'The metabolite '</span> mets{i} <span class="string">' is not correctly formatted for eqnType=3'</span>];
0489           <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0490         <span class="keyword">end</span>
0491 
0492         <span class="comment">%Check that the compartment is correct</span>
0493         compartments{i}=mets{i}(starts+1:ends-1);
0494         I=ismember(compartments(i),newModel.comps);
0495         <span class="keyword">if</span> ~I
0496             EM=[<span class="string">'The metabolite '</span> mets{i} <span class="string">' has a compartment that is not in model.comps'</span>];
0497             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0498         <span class="keyword">end</span>
0499         metNames{i}=mets{i}(1:starts-1);
0500     <span class="keyword">end</span>
0501 
0502     <span class="comment">%Check if the metabolite exists already</span>
0503     t1=strcat(metNames,<span class="string">'***'</span>,compartments);
0504     [I J]=ismember(t1,t2);
0505 
0506     <span class="keyword">if</span> ~all(I)
0507         <span class="keyword">if</span> allowNewMets==true
0508             <span class="comment">%Add the new mets</span>
0509             metsToAdd.metNames=metNames(~I);
0510             metsToAdd.compartments=compartments(~I);
0511             newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo)">addMets</a>(newModel,metsToAdd);
0512         <span class="keyword">else</span>
0513             EM=<span class="string">'One or more equations contain metabolites that are not in model.metNames. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0514             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0515         <span class="keyword">end</span>
0516     <span class="keyword">end</span>
0517 
0518     <span class="comment">%Calculate the indexes of the metabolites</span>
0519     metIndexes=J;
0520     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0521 <span class="keyword">end</span>
0522 
0523 <span class="comment">%Add the info to the stoichiometric matrix and to the rxnGeneMat. I do this</span>
0524 <span class="comment">%in a loop, but maybe not necessary</span>
0525 newModel.S=[newModel.S sparse(size(newModel.S,1),nRxns)];
0526 <span class="keyword">for</span> i=1:nRxns
0527     newModel.S(metIndexes,nOldRxns+i)=S(:,i);
0528 
0529     <span class="comment">%Parse the grRules and add to rxnGeneMat</span>
0530     <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0531        rule=newModel.grRules{nOldRxns+i};
0532        rule=strrep(rule,<span class="string">'('</span>,<span class="string">''</span>);
0533        rule=strrep(rule,<span class="string">')'</span>,<span class="string">''</span>);
0534        rule=strrep(rule,<span class="string">' or '</span>,<span class="string">' '</span>);
0535        rule=strrep(rule,<span class="string">' and '</span>,<span class="string">' '</span>);
0536        genes=regexp(rule,<span class="string">' '</span>,<span class="string">'split'</span>);
0537        [I J]=ismember(genes,newModel.genes);
0538        <span class="keyword">if</span> ~all(I) &amp;&amp; any(rule)
0539             EM=[<span class="string">'Not all genes for reaction '</span> rxnsToAdd.rxns{i} <span class="string">' were found in model.genes. If needed, add genes with addGenes before calling this function'</span>];
0540             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0541        <span class="keyword">end</span>
0542        <span class="keyword">if</span> any(rule)
0543             newModel.rxnGeneMat(nOldRxns+i,J)=1;
0544        <span class="keyword">else</span>
0545             <span class="comment">%If there are no genes for the reaction, the rxnGeneMat should</span>
0546             <span class="comment">%still be resized</span>
0547             newModel.rxnGeneMat=[newModel.rxnGeneMat;sparse(1,numel(newModel.genes))];
0548        <span class="keyword">end</span>
0549     <span class="keyword">end</span>
0550 <span class="keyword">end</span>
0551 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 28-Feb-2017 23:41:43 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>